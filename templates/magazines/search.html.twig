{% extends 'base.html.twig' %}

{% block title %}Recherche Magazines{% endblock %}

{% block body %}
<div id="titleListe">
    <div class="card mb-4">
        <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0 text-white">
                    <i class="fas fa-search"></i> Recherche de magazines
                </h5>
                {% if totalResults is defined and totalResults > 0 %}
                    <span class="badge badge-light px-3 py-2">{{ totalResults }} magazine(s)</span>
                {% endif %}
            </div>
        </div>
        <div class="card-body">
            <form action="{{ path('magazines_search') }}" method="get" class="mb-3" id="searchForm">
                <div class="row">
                    <div class="col-md-5 mb-2">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text bg-white border-right-0"><i class="fas fa-book-open text-primary"></i></span>
                            </div>
                            <input type="text" name="q" class="form-control border-left-0" id="search"
                                   value="{{ searchQuery }}" 
                                   placeholder="Nom du magazine ou éditeur...">
                        </div>
                    </div>
                    <div class="col-md-4 mb-2">
                        <select name="user" class="form-control">
                            <option value="0">Toutes les collections</option>
                            {% if users is defined %}
                                {% for user in users %}
                                    <option value="{{ user.id }}" {% if searchUserId is defined and searchUserId == user.id %}selected{% endif %}>
                                        {{ user.name }} {{ user.lastName }}
                                    </option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-search"></i> Rechercher
                        </button>
                    </div>
                </div>
            </form>
            
            {% if searchQuery %}
                <div class="d-flex flex-wrap align-items-center mb-3">
                    <span class="mr-2 text-muted">Recherche actuelle :</span>
                    <span class="badge badge-primary mr-2 px-3 py-2" style="font-size: 0.95rem;">{{ searchQuery }}</span>
                    {% if searchUser %}
                        <span class="badge badge-success px-3 py-2" style="font-size: 0.95rem;">
                            <i class="fas fa-user"></i> {{ searchUser }}
                        </span>
                    {% endif %}
                </div>
            {% endif %}
            
            {% if totalResults is defined and totalResults == 0 %}
            <div class="alert alert-warning border-0" style="background-color: #fff3cd;">
                <h5 class="alert-heading"><i class="fas fa-exclamation-triangle"></i> Aucun résultat</h5>
                <p class="mb-2">Aucun magazine ne correspond à "<strong>{{ searchQuery }}</strong>"</p>
                <hr>
                <p class="mb-0 small">
                    <strong>Suggestions :</strong> Vérifiez l'orthographe ou essayez des termes plus généraux.
                </p>
            </div>
            {% endif %}
            
            <div class="d-flex flex-wrap">
                <a href="{{ path('magazines_list') }}" class="btn btn-outline-secondary mb-2">
                    <i class="fas fa-list"></i> Tous les magazines
                </a>
            </div>
        </div>
    </div>
</div>

{% if results is defined and results|length > 0 %}
    {% include 'includes/tableauMagazines.html.twig' with {'pagination' : pagination, 'images' : images, 'results' : results}%}
{% endif %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/image-modal.js') }}"></script>
{% endblock %}
